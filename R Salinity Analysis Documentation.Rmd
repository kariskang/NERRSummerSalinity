---
title: "RStudio Codespace for NERR Salinity Analysis"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Project Goals:

-   Using monthly summarized water quality data from May to Aug (1996 -2021) collected from three sites, find:

    -   average summer salinity
    -   average summer salinity variance

-   Determine if differences are significant among:

    -   Sites
    -   Years
    -   Years x Sites

-   Plot yearly summer salinity across years for all sites

## Import Libraries

```{r libraries}
library(tidyverse)
```

## Import Formatted Salinity Data

```{r dataframes}
# import data from https://raw.githubusercontent.com/kariskang/NERRSummerSalinity/main/SummerSalinity.csv 
SummerSalinity <- read.csv('https://tinyurl.com/msaejryj') 
```

## Summary Data for Dataset

```{r summarydataframes}
# check sample size for each site to make sure they're comparable
SummerSalinity %>% 
    group_by(Site) %>% 
    summarize(DataPtCount_Site = n())
```

## Find average summer salinity and variance for each site across all years

```{r siteavg}
# check mean summer salinity and mean summer salinity variance across all years for each site
SummerSalinity %>% 
  group_by(Site) %>% 
  summarize(AvgSal = mean(mean_salinity), 
            AvgVar = var(mean_salinity))

```

## Statistical Analysis using ANOVA

```{r anova}

# I want the differences among sites across all years, and difference among years grouped by site (interaction of Site x Year)
ANOVASitesYears <- aov(mean_salinity ~ Site*year, data = SummerSalinity)
#summary of ANOVA results
summary(ANOVASitesYears)
```

There is a significant difference ($\alpha$ = 0.05) in mean summer salinity among sites (f = 1274.845, p \< 2e-16) and among years when looking at all sites grouped together (f = 10.002, p = 0.00173), but not among years when each site is taken into account separately (f = 1.093, p = 0.33647)

## Post-hoc Tukey test to determine significance in salinity differences among sites

```{r tukey}

#I want to know which groups in Sites are significant from the others, and by how much

#Running a Tukey test; thank you statology.org for my life
TukeyHSD(ANOVASitesYears, 'Site', conf.level=.95) 
#Plotting Tukey test results
plot(TukeyHSD(ANOVASitesYears, 'Site'))
```

Average summer salinity is significantly different among all three sites. Wells, ME has the largest negative difference from Narragansett Bay and Great Bay despite the fact that Great Bay, NH, and Wells, ME are closer geographically (\~39 km) than Great Bay NH, and Narragansett Bay, RI (\~167 km).

## Plot mean summer salinity across years for each site

```{r salplots}

# average mean salinity values from May to Aug so there's one summer salinity value for each year
yearlysummersal <- SummerSalinity %>% 
  group_by(Site, year) %>% 
  summarize(yearlysummersal = mean(mean_salinity))

# went back and created a labels variable so site order in the legend would match the order on the graph
labels <- yearlysummersal %>% filter(year == 2021) %>% 
  arrange(desc(yearlysummersal)) %>% pull(Site)

# plot average yearly summer salinity across years for each site 
ggplot(yearlysummersal, aes(year, yearlysummersal, color = Site)) +
  geom_line() +
  labs(x = "Year", y = "Mean Summer Salinity (psu)", color = "") +
  theme_bw() + 
  scale_color_discrete(breaks = labels, labels = labels) 
```

**Figure 1.** Average summer salinity at New England coastal research stations has not changed significantly overall over the past 26 years (ANOVA, Factor = Site x Year, f = 1.093, p =0.33647, $\alpha$ = 0.05). However, average summer salinity is different among research stations (ANOVA, Factor = Site, f = 1274.845, p \< 2e-16, $\alpha$ = 0.05), with lower average summer salinity values at higher latitudes (Narragansett Bay, RI: 41.64055, Great Bay, NH: 43.0722, Wells, ME: 43.298347).
